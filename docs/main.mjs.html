<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>main.mjs - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/pricemi115/grumptech-astrodata" target="_blank" >GrumpTech</a></h2><h3>Modules</h3><ul><li><a href="module-AstronomicalDataAPIModule.html">AstronomicalDataAPIModule</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-AstronomicalDataAPIModule.html#.API_ASTRONOMICAL_DATA_EVENTS">API_ASTRONOMICAL_DATA_EVENTS</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="module-AstronomicalDataAPIModule.html#event:event:busy">busy</a></li><li><a href="module-AstronomicalDataAPIModule.html#event:event:request_complete">request_complete</a></li></ul><h3>Classes</h3><ul><li><a href="module-AstronomicalDataAPIModule.AstronomicalDataAPI.html">AstronomicalDataAPI</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-AstronomicalDataAPIModule.AstronomicalDataAPI.html#IsLocationValid">IsLocationValid</a></li><li data-type='method' style='display: none;'><a href="module-AstronomicalDataAPIModule.AstronomicalDataAPI.html#RequestAstronomicalOneDayData">RequestAstronomicalOneDayData</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-license.html">license</a></li><li><a href="tutorial-security.html">security</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">main.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// External dependencies and imports.
import EventEmitter from 'events';
import _debugModule from 'debug';
import _is from 'is-it-check';

// Internal dependency and imports
import {AstroDataRSTOneDay, ASTRONOMICAL_DATA_EVENTS} from './astroRiseSetTransitOneDay.mjs';

/**
 * @description Exposes Astronomical Data to external clients.
 * @copyright 2023-2023
 * @author Mike Price &lt;dev.grumptech@gmail.com>
 * @module AstronomicalDataAPIModule
 * @requires debug
 * @see {@link https://github.com/debug-js/debug#readme}
 * @requires events
 * @see {@link https://nodejs.org/dist/latest-v16.x/docs/api/events.html#events}
 * @requires crypto
 * @see {@link https://nodejs.org/dist/latest-v16.x/docs/api/crypto.html#crypto}
 * @requires is-it-check
 * @see {@link https://github.com/evdama/is-it-check}
 */

/**
 * @description Debugging function pointer for runtime related diagnostics.
 * @private
 */
// eslint-disable-next-line no-unused-vars
const _debug = _debugModule('api');

/**
 * @description Package Information
 * @private
 */
const _PackageInfo = {PLUGIN_VER: 'PLACEHOLDER_VERSION'};

/**
 * @description Enumeration of published events.
 * @readonly
 * @enum {string}
 * @property {string} API_EVENT_DATA_PROCESSING - Identification for the event published when initiatng astronomical data processing.
 * @property {string} API_EVENT_DATA_PROCESS_COMPLETE - Identification for the event published when initiatng astronomical data processing completes.
 */
export const API_ASTRONOMICAL_DATA_EVENTS = {
    /* eslint-disable key-spacing */
    API_EVENT_DATA_BUSY             : 'busy',
    API_EVENT_DATA_REQUEST_COMPLETE : 'request_complete',
    /* eslint-enable key-spacing */
};

/**
 * @description Module busy servicing a request
 * @event module:AstronomicalDataAPIModule#event:busy
 * @type {object}
 * @param {boolean} e.busy -Flag indicating the astronomical data is being updated.
 */
/**
 * @description Astronomical Data Request Complete
 * @event module:AstronomicalDataAPIModule#event:request_complete
 * @type {object}
 * @param {boolean} e.status - Flag indicating the is the processing resulted in an error.
 * @param {object} e.data - Object containing data of interest (request specific).
 */
/**
 * @description API for Astronomical Data
 * @augments EventEmitter
 */
export class AstronomicalDataAPI extends EventEmitter {
    /**
     * @description Constructor
     */
    constructor() {
        // Initialize the base class.
        super();

        /* Bind Handlers */
        this._bindDestructorNormal   = this._destructor.bind(this, {cleanup: true});
        this._bindDestructorAbnormal = this._destructor.bind(this, {exit: true});

        // Create the RST object
        this._astroRSTOneDay = new AstroDataRSTOneDay();
        this._astroRSTOneDay.on(ASTRONOMICAL_DATA_EVENTS.EVENT_DATA_PROCESSING, this._handleRSTDataProcessing.bind(this));
        this._astroRSTOneDay.on(ASTRONOMICAL_DATA_EVENTS.EVENT_DATA_PROCESS_COMPLETE, this._handleRSTDataProcessComplete.bind(this));

        // Busy flag.
        this._busy = false;
        // Pending flag
        this._pending = false;

        // Register for shutdown events.
        // do something when app is closing
        process.on('exit', this._bindDestructorNormal.bind(this));
        // catches uncaught exceptions
        process.on('uncaughtException', this._bindDestructorAbnormal.bind(this));
    }

    /**
     * @description Destructor
     * @param {object} options - Typically containing a "cleanup" or "exit" member.
     * @param {object} err - The source of the event trigger.
     * @returns {void}
     * @async
     * @private
     */
    async _destructor(options, err) {
        // Is there an indication that the system is either exiting or needs to
        // be cleaned up?
        if ((options.exit) || (options.cleanup)) {
            this._log.debug('Terminating the astronomical data api.');
            this._log.debug(err);
        }
        // Lastly eliminate myself.
        delete this;
    }

    /**
     * @description Read only accessor for the module version.
     * @returns {string} - Version
     */
    get Version() {
        return _PackageInfo.PLUGIN_VER;
    }

    /**
     * @description Read only property for the RST One Day Data
     * @returns {object} = RST OneDay Data
     */
    get RSTOneDayData() {
        let data = undefined;

        if (_is.truthy(this._astroRSTOneDay)) {
            // eslint-disable-next-line new-cap
            data = this._astroRSTOneDay.ObjectData;
        }

        return data;
    }

    /**
     * @description Helper for requesting and collecting astronomical point data.
     * @param {object} config - Configuration data
     * @param {string=} config.id - Identifier for the request to the US Naval Observatory
     * @param {Date=} config.date - Observation Date. If not specified use current time.
     * @param {object} config.location - Location for the astronomical data.
     * @param {number} config.location.latitude - Latitude
     * @param {object} config.location.longitude - longitude
     * @throws {TypeError} - Thrown if 'config' is invalid.
     * @throws {RangeError} - Thrown if 'config' is invalid.
     * @returns {void}
     * @fires module:AstronomicalDataAPIModule#event:busy
     * @fires module:AstronomicalDataAPIModule#event:request_complete
     */
    RequestAstronomicalOneDayData(config) {
        // Validate arguments
        if (_is.not.undefined(config)) {
            if (_is.not.object(config)) {
                throw new TypeError(`Invalid configuration.`);
            }
            if (_is.not.undefined(config.id) &amp;&amp; _is.not.string(config.id)) {
                throw new RangeError(`Invalid configuration. ID=${config.id}`);
            }
            if (_is.not.undefined(config.date) &amp;&amp; _is.not.date(config.date)) {
                throw new RangeError(`Invalid configuration. Date=${config.date}`);
            }
            // Validate the location
            // eslint-disable-next-line new-cap
            AstroDataRSTOneDay.CheckLocation(config);
        }
        else {
            throw new TypeError(`config is unspecified.`);
        }

        // Append the id field to the configuration.
        if (_is.undefined(config.id)) {
            config.id = `GTAstro`;
        }

        // Initiate the request
        // eslint-disable-next-line new-cap
        this._astroRSTOneDay.RequestAstronomicalOneDayData(config);
    }

    /**
     * @description Validates the location specified.
     * @param {object} location - Location for the astronomical data.
     * @param {number} location.latitude - Latitude
     * @param {object} location.longitude - longitude
     * @returns {boolean} - true if the specified location is valid.
     */
    IsLocationValid(location) {
        let valid = false;

        try {
            // eslint-disable-next-line new-cap
            AstroDataRSTOneDay.CheckLocation({location: location});
            valid = true;
        }
        finally {
            // Nothing to do.
        }

        return valid;
    }

    /**
     * @description - Event handler indicating a change in the 'processing' state.
     * @param {object} e - Event notification data
     * @param {boolean} e.processing - Flag indicating the astronomical data is being updated.
     * @returns {void}
     * @private
     */
    _handleRSTDataProcessing(e) {
        // Clear the pending flag
        this._pending = false;
        // Cache the busy flag.
        this._busy = e.processing;

        // Pass along the event
        setImmediate(() => {
            this.emit(API_ASTRONOMICAL_DATA_EVENTS.API_EVENT_DATA_BUSY, {busy: this._busy});
        });
    }

    /**
     * @description - Event handler to process the astronomical request results.
     * @param {object} e - Event notification data
     * @param {boolean} e.status - Error indicator (false==no error)
     * @returns {void}
     * @private
     */
    _handleRSTDataProcessComplete(e) {
        const result = {status: e.status, data: this._astroRSTOneDay.ObjectData};

        // Pass along the response
        setImmediate(() => {
            this.emit(API_ASTRONOMICAL_DATA_EVENTS.API_EVENT_DATA_REQUEST_COMPLETE, result);
        });
    }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
